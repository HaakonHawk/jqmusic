function shuffle(a){for(var t,e,s=a.length;0!==s;)e=Math.floor(Math.random()*s),s-=1,t=a[s],a[s]=a[e],a[e]=t;return a}function round(a,t){return Number(Math.round(a+"e"+t)+"e-"+t)}if(displaymeta){var jsmediatags=window.jsmediatags;tracklocation=window.location.href+tracklocation}if(displaymeta)if(usefa)var buttons=['<span class="jsmusicPlayer-'+theme+'">','<div class="music-player">','<center><div class="cover"></div></center>','<p class="info">Waiting...</p>','<div class="progress">','<span class="bar">&nbsp;</span>',"</div>","<center>",'<button class="shuffle"><i class="fa fa-random" aria-hidden="true"></i></button>','<button class="prev"><i class="fa fa-backward" aria-hidden="true"></i></button>','<button class="play"><i class="fa fa-play" aria-hidden="true"></i></button>','<button class="next"><i class="fa fa-forward" aria-hidden="true"></i></button>','<button class="repeat"><i class="fa fa-repeat" aria-hidden="true"></i></button>',"</center>","</div>","</span>"];else var buttons=['<span class="jsmusicPlayer-'+theme+'">','<div class="music-player">','<center><div class="cover"></div></center>','<p class="info">Waiting...</p>','<div class="progress">','<span class="bar">&nbsp;</span>',"</div>","<center>",'<button class="shuffle">Shuffle</button>','<button class="prev">Previous</button>','<button class="play">Play</button>','<button class="next">Next</button>','<button class="repeat">Repeat</button>',"</center>","</div>","</span>"];else if(usefa)var buttons=['<span class="jsmusicPlayer-'+theme+'">','<div class="music-player">','<div class="progress">','<span class="bar">&nbsp;</span>',"</div>","<center>",'<button class="shuffle"><i class="fa fa-random" aria-hidden="true"></i></button>','<button class="prev"><i class="fa fa-backward" aria-hidden="true"></i></button>','<button class="play"><i class="fa fa-play" aria-hidden="true"></i></button>','<button class="next"><i class="fa fa-forward" aria-hidden="true"></i></button>','<button class="repeat"><i class="fa fa-repeat" aria-hidden="true"></i></button>',"</center>","</div>","</span>"];else var buttons=['<span class="jsmusicPlayer-'+theme+'">','<div class="music-player">','<div class="progress">','<span class="bar">&nbsp;</span>',"</div>","<center>",'<button class="shuffle">Shuffle</button>','<button class="prev">Previous</button>','<button class="play">Play</button>','<button class="next">Next</button>','<button class="repeat">Repeat</button>',"</center>","</div>","</span>"];var track,artist,title,tracknumber=0,tracksmax=0,tracks=[],unshuffledtracks,playing=!1,shuffled=!1,repeat=!1,ready=!1;$(document).ready(function(){function a(){var a=track.currentTime/track.duration*100;a=round(a,1),$(".bar").css("width",a+"%")}function t(){displaymeta?playing?(track.pause(),playing=!1,console.log("Stopped playing: "+tracks[tracknumber].artist+" - "+tracks[tracknumber].title),usefa?$(".play").html('<i class="fa fa-play" aria-hidden="true"></i>'):$(".play").text("Play"),tracks[tracknumber].cover?$(".cover").html('<img class="picture" src="'+tracks[tracknumber].cover+'" />'):$(".cover").html("")):(track.play(),playing=!0,console.log("Now playing: "+tracks[tracknumber].artist+" - "+tracks[tracknumber].title),$(".info").text(tracks[tracknumber].artist+" - "+tracks[tracknumber].title),usefa?$(".play").html('<i class="fa fa-pause" aria-hidden="true"></i>'):$(".play").text("Pause"),tracks[tracknumber].cover?$(".cover").html('<img class="picture" src="'+tracks[tracknumber].cover+'" />'):$(".cover").html("")):playing?(track.pause(),playing=!1,usefa?$(".play").html('<i class="fa fa-play" aria-hidden="true"></i>'):$(".play").text("Play")):(track.play(),playing=!0,usefa?$(".play").html('<i class="fa fa-pause" aria-hidden="true"></i>'):$(".play").text("Pause")),track.onended=function(){repeat?(playing=!1,t()):e()}}function e(){playing&&t(),tracknumber>=tracksmax?tracknumber=0:tracknumber+=1,track=new Audio(tracklocation+tracks[tracknumber].file),t()}function s(){playing&&t(),0>=tracknumber?tracknumber=tracksmax:tracknumber-=1,track=new Audio(tracklocation+tracks[tracknumber].file),t()}$(loadto).empty(),$(loadto).html(buttons.join("")),$.ajax({url:tracklocation,success:function(a){$(a).find("td > a").each(function(){if($(this).attr("href").endsWith(".mp3")||$(this).attr("href").endsWith(".ogg")){var a=$(this).attr("href");displaymeta?jsmediatags.read(tracklocation+$(this).attr("href"),{onSuccess:function(t){artist=t.tags.artist?t.tags.artist:"Unknown",title=t.tags.title?t.tags.title:"Unknown";var e=t.tags.picture;if(e){for(var s="",r=0;r<e.data.length;r++)s+=String.fromCharCode(e.data[r]);var n="data:"+e.format+";base64,"+window.btoa(s);tracks.push({file:a,title:title,artist:artist,cover:n})}else tracks.push({file:a,title:title,artist:artist,cover:!1})},onError:function(t){console.log(t),tracks.push({file:a,title:"N/A",artist:"N/A",cover:!1})}}):tracks.push({file:a,title:"N/A",artist:"N/A",cover:"N/A"})}}),setTimeout(function(){tracksmax=tracks.length-1,track=new Audio(tracklocation+tracks[tracknumber].file),ready=!0,displaymeta&&$(".info").text(tracks[tracknumber].artist+" - "+tracks[tracknumber].title)},3e3)}}),setInterval(function(){ready&&a()},1e3),$(".play").click(function(){ready&&t()}),$(".prev").click(function(){ready&&s()}),$(".next").click(function(){ready&&e()}),$(".shuffle").click(function(){ready&&(shuffled?($(".shuffle").toggleClass("active"),shuffled=!1,tracks=unshuffledtracks):($(".shuffle").toggleClass("active"),shuffled=!0,unshuffledtracks=tracks,shuffle(tracks)))}),$(".repeat").click(function(){ready&&(repeat?($(".repeat").toggleClass("active"),repeat=!1):($(".repeat").toggleClass("active"),repeat=!0))})});